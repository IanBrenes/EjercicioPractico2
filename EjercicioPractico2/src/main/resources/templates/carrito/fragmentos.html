<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <body>

        <!-- ======================== -->
        <!-- MINI RESUMEN DEL CARRITO -->
        <!-- ======================== -->
        <div th:fragment="verCarrito" th:if="${listaItems != null and !#lists.isEmpty(listaItems)}">
            <a th:href="@{/carrito/listado}" class="btn btn-outline-primary d-inline-flex align-items-center gap-2">
                <i class="fas fa-shopping-cart"></i>
                <span>[[#{carrito.verCarrito}]]</span>
                <span class="badge text-bg-primary" th:text="${listaTotal}">0</span>
            </a>
        </div>

        <!-- =================== -->
        <!-- LISTADO DEL CARRITO -->
        <!-- =================== -->
        <section th:fragment="listadoCarrito" id="items">
            <div class="container py-3">
                <div class="row g-3">
                    <!-- CONTENIDO PRINCIPAL -->
                    <main class="col-lg-9">
                        <div class="card shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">[[#{carrito.titulo}]]</h4>
                                <a th:href="@{/}" class="btn btn-link p-0">
                                    <i class="fas fa-store"></i> [[#{carrito.seguirComprando}]]
                                </a>
                            </div>

                            <!-- Tabla solamente si hay items -->
                            <div class="table-responsive" th:if="${items != null and !items.empty}">
                                <table class="table table-hover table-sm align-middle mb-0">
                                    <colgroup>
                                        <col style="width:4%">
                                            <col style="width:36%">
                                                <col style="width:15%">
                                                    <col style="width:15%">
                                                        <col style="width:15%">
                                                            <col style="width:15%">
                                                                </colgroup>
                                                                <thead class="table-dark">
                                                                    <tr>
                                                                        <th>#</th>
                                                                        <th>[[#{pelicula.titulo}]]</th>
                                                                        <th class="text-end">[[#{pelicula.precio}]]</th>
                                                                        <th class="text-center">[[#{carrito.cantidad}]]</th>
                                                                        <th class="text-end">[[#{carrito.total}]]</th>
                                                                        <th class="text-center">[[#{accion.acciones}]]</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr th:each="it, stat : ${items}">
                                                                        <td th:text="${stat.index + 1}">1</td>
                                                                        <td th:text="${it.titulo}">Título</td>
                                                                        <td class="text-end" th:text="${#numbers.formatCurrency(it.precio)}">$0.00</td>
                                                                        <td class="text-center" th:text="${it.cantidad}">1</td>
                                                                        <td class="text-end"
                                                                            th:text="${#numbers.formatCurrency(it.cantidad * it.precio)}">$0.00</td>
                                                                        <td class="text-center">
                                                                            <div class="btn-group btn-group-sm" role="group" aria-label="acciones">
                                                                                <a class="btn btn-outline-success"
                                                                                   th:href="@{/carrito/modificar/{idPelicula}(idPelicula=${it.idPelicula})}">
                                                                                    <i class="fas fa-pen"></i> [[#{accion.actualizar}]]
                                                                                </a>
                                                                                <a class="btn btn-outline-danger"
                                                                                   th:href="@{/carrito/eliminar/{idPelicula}(idPelicula=${it.idPelicula})}">
                                                                                    <i class="fas fa-trash"></i> [[#{accion.eliminar}]]
                                                                                </a>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                                <tfoot>
                                                                    <tr class="fw-semibold">
                                                                        <td colspan="4" class="text-end">[[#{carrito.totalCompra}]]</td>
                                                                        <td class="text-end">
                                                                            <span th:text="${#numbers.formatCurrency(carritoTotal)}">$0.00</span>
                                                                        </td>
                                                                        <td></td>
                                                                    </tr>
                                                                </tfoot>
                                                                </table>
                                                                </div>

                                                                <!-- Estado vacío -->
                                                                <div class="p-5 text-center" th:if="${items == null or items.empty}">
                                                                    <i class="fas fa-shopping-basket fa-2x mb-3 text-muted"></i>
                                                                    <p class="mb-0">[[#{carrito.no_mostrar}]]</p>
                                                                    <a th:href="@{/}" class="btn btn-primary mt-3">
                                                                        <i class="fas fa-store"></i> [[#{carrito.seguirComprando}]]
                                                                    </a>
                                                                </div>
                                                                </div>
                                                                </main>

                                                                <!-- RESUMEN / ACCIONES -->
                                                                <aside class="col-lg-3">
                                                                    <div class="card text-center border-0 shadow-sm mb-3">
                                                                        <div class="card-body">
                                                                            <h6 class="text-muted mb-1">[[#{carrito.totalCompra}]]</h6>
                                                                            <div class="display-6" th:text="${#numbers.formatCurrency(carritoTotal)}">$0.00</div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="d-grid gap-2">
                                                                        <a th:href="@{/}" class="btn btn-outline-secondary">
                                                                            <i class="fas fa-reply"></i> [[#{carrito.seguirComprando}]]
                                                                        </a>
                                                                        <a th:href="@{/facturar/carrito}" class="btn btn-success">
                                                                            <i class="fas fa-credit-card"></i> [[#{carrito.facturar}]]
                                                                        </a>
                                                                    </div>
                                                                </aside>
                                                                </div>
                                                                </div>
                                                                </section>

                                                                <!-- ================ -->
                                                                <!-- MODIFICAR ÍTEM   -->
                                                                <!-- ================ -->
                                                                <section th:fragment="modificar" th:object="${item}">
                                                                    <div class="container py-3">
                                                                        <div class="mb-3">
                                                                            <a th:href="@{/carrito/listado}" class="btn btn-outline-primary">
                                                                                <i class="fas fa-arrow-left"></i> [[#{accion.regresar}]]
                                                                            </a>
                                                                        </div>

                                                                        <div class="row g-3">
                                                                            <div class="col-lg-6">
                                                                                <div class="card shadow-sm h-100">
                                                                                    <div class="card-header">
                                                                                        <h5 class="mb-0">[[#{carrito.datos}]]</h5>
                                                                                    </div>
                                                                                    <div class="card-body">
                                                                                        <h5 class="card-title mb-1">[[*{titulo}]]</h5>
                                                                                        <p class="card-subtitle text-muted">
                                                                                            [[#{pelicula.precio}]]:
                                                                                            <strong th:text="${#numbers.formatCurrency(item.precio)}">$0.00</strong>
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-lg-6">
                                                                                <div class="card shadow-sm h-100">
                                                                                    <div class="card-body">
                                                                                        <form th:action="@{/carrito/guardar}" method="post" class="needs-validation" novalidate>
                                                                                            <input type="hidden" name="idPelicula" th:field="*{idPelicula}"/>

                                                                                            <div class="form-floating mb-3">
                                                                                                <input id="cantidad" name="cantidad" type="number" min="1" step="1"
                                                                                                       class="form-control" th:field="*{cantidad}" required/>
                                                                                                <label for="cantidad">[[#{carrito.cantidad}]]</label>
                                                                                                <div class="invalid-feedback">[[#{validacion.requerido}]]</div>
                                                                                            </div>

                                                                                            <div class="d-flex gap-2">
                                                                                                <button class="btn btn-success" type="submit" name="guardar">
                                                                                                    <i class="fas fa-save"></i> [[#{accion.guardar}]]
                                                                                                </button>
                                                                                                <a th:href="@{/carrito/eliminar/{idPelicula}(idPelicula=${item.idPelicula})}"
                                                                                                   class="btn btn-outline-danger">
                                                                                                    <i class="fas fa-trash"></i> [[#{accion.eliminar}]]
                                                                                                </a>
                                                                                            </div>
                                                                                        </form>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </section>

                                                                </body>
                                                                </html>
